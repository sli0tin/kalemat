<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تحدي الكلمات</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-start: #f4fbff;
        --bg-end: #fff6eb;
        --ink: #12343b;
        --muted: #5f7e86;
        --primary: #0f8b8d;
        --primary-dark: #0a7072;
        --accent: #ff8a5b;
        --surface: rgba(255, 255, 255, 0.88);
        --surface-strong: #ffffff;
        --border: rgba(18, 52, 59, 0.12);
        --shadow: 0 14px 30px rgba(14, 52, 59, 0.16);
        --radius-xl: 22px;
        --radius-lg: 16px;
        --radius-md: 12px;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: "Cairo", sans-serif;
        color: var(--ink);
        background: linear-gradient(150deg, var(--bg-start), var(--bg-end));
        min-height: 100dvh;
        position: relative;
        overflow: hidden;
      }

      body::before,
      body::after {
        content: "";
        position: fixed;
        border-radius: 50%;
        filter: blur(2px);
        z-index: -1;
      }

      body::before {
        width: 280px;
        height: 280px;
        right: -120px;
        top: -90px;
        background: radial-gradient(circle at 40% 40%, #ffb38f, #ff8a5b);
        opacity: 0.28;
      }

      body::after {
        width: 320px;
        height: 320px;
        left: -150px;
        bottom: -110px;
        background: radial-gradient(circle at 50% 50%, #8ed4d5, #55b7b8);
        opacity: 0.22;
      }

      .app {
        width: min(100%, 440px);
        margin: 0 auto;
        height: 100dvh;
        padding: 10px 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .app-head {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 10px 12px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(8px);
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15, 139, 141, 0.12);
        color: var(--primary-dark);
        font-size: 12px;
        font-weight: 700;
      }

      h1 {
        margin: 8px 0 2px;
        font-size: 25px;
        line-height: 1.25;
      }

      .subtitle {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
      }

      .progress {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-top: 8px;
      }

      .progress span {
        display: block;
        height: 6px;
        border-radius: 99px;
        background: rgba(15, 139, 141, 0.16);
        transition: background-color 0.25s ease;
      }

      .progress span.active {
        background: linear-gradient(90deg, var(--primary), #48acaf);
      }

      .screen {
        display: none;
        animation: rise 0.32s ease;
        height: 100%;
        min-height: 0;
      }

      .screen.active {
        display: flex;
      }

      @keyframes rise {
        from {
          opacity: 0;
          transform: translateY(14px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .panel {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-xl);
        padding: 12px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(6px);
        display: flex;
        flex-direction: column;
        gap: 4px;
        width: 100%;
        min-height: 0;
      }

      .panel h2 {
        margin: 0 0 4px;
        font-size: 20px;
      }

      .panel p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .form-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 10px;
        flex: 1;
        min-height: 0;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 700;
        margin-bottom: 6px;
      }

      input[type="text"] {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        min-height: 42px;
        padding: 9px 12px;
        font: inherit;
        color: var(--ink);
        background: var(--surface-strong);
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      input[type="text"]:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(15, 139, 141, 0.16);
        outline: none;
      }

      .actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
      }

      button {
        border: none;
        font: inherit;
        font-weight: 700;
        border-radius: 12px;
        min-height: 42px;
        padding: 0 14px;
        cursor: pointer;
      }

      .btn-primary {
        flex: 1;
        color: #fff;
        background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      }

      .btn-secondary {
        color: var(--ink);
        background: #eef5f6;
      }

      .error {
        min-height: 16px;
        margin-top: 6px;
        font-size: 12px;
        color: #c42c2c;
      }

      .hint {
        margin-top: 8px;
        background: rgba(255, 138, 91, 0.11);
        color: #a14922;
        border-radius: 12px;
        padding: 6px 8px;
        font-size: 12px;
      }

      .sortable-list {
        list-style: none;
        margin: 8px 0 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        min-height: 0;
      }

      .word-card {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        background: var(--surface-strong);
        box-shadow: 0 8px 18px rgba(16, 56, 63, 0.12);
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        touch-action: none;
        user-select: none;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
        cursor: grab;
      }

      .word-card.dragging {
        opacity: 0.92;
        box-shadow: 0 18px 30px rgba(11, 55, 60, 0.26);
        cursor: grabbing;
      }

      .order-index {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        background: rgba(15, 139, 141, 0.14);
        color: var(--primary-dark);
        font-size: 13px;
        font-weight: 800;
        flex-shrink: 0;
      }

      .word-text {
        flex: 1;
        font-size: 16px;
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .drag-mark {
        color: var(--muted);
        font-size: 18px;
        line-height: 1;
      }

      .result-header {
        margin-bottom: 8px;
      }

      .result-title {
        margin: 0 0 8px;
        font-size: 20px;
      }

      .player-meta {
        background: var(--surface-strong);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 8px;
        display: grid;
        gap: 4px;
      }

      .meta-line {
        margin: 0;
        font-size: 14px;
        font-weight: 700;
      }

      .meta-line span {
        color: var(--muted);
        font-weight: 600;
      }

      .result-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 8px;
        flex: 1;
        min-height: 0;
      }

      .result-card {
        background: var(--surface-strong);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 8px;
      }

      .result-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 6px;
      }

      .result-rank {
        font-size: 13px;
        font-weight: 800;
        color: var(--primary-dark);
      }

      .result-length {
        font-size: 12px;
        color: var(--muted);
        font-weight: 700;
      }

      .slots {
        display: flex;
        flex-wrap: nowrap;
        gap: 4px;
        overflow-x: auto;
        overflow-y: hidden;
        padding-bottom: 1px;
      }

      .slot {
        width: 26px;
        height: 30px;
        border: 1px solid rgba(18, 52, 59, 0.24);
        border-radius: 8px;
        display: grid;
        place-items: center;
        font-size: 15px;
        font-weight: 800;
        color: var(--ink);
        flex-shrink: 0;
        background: #fdfefe;
      }

      .slot.revealed {
        background: rgba(15, 139, 141, 0.12);
        border-color: rgba(15, 139, 141, 0.5);
      }

      .restart-wrap {
        margin-top: 8px;
      }

      main {
        flex: 1;
        min-height: 0;
      }

      @media (max-height: 760px) {
        .app {
          padding: 8px 8px 10px;
          gap: 8px;
        }

        .app-head {
          padding: 8px 10px;
        }

        .panel {
          padding: 10px;
        }

        .panel h2 {
          font-size: 18px;
        }

        label {
          font-size: 13px;
          margin-bottom: 4px;
        }

        input[type="text"] {
          min-height: 38px;
          padding: 8px 10px;
        }

        .word-card {
          padding: 8px;
        }

        .result-title {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header class="app-head">
        <span class="badge">لعبة تحدي الكلمات</span>
        <div class="progress" id="progress">
          <span class="active"></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </header>

      <main>
        <section class="screen active" id="screen-intro">
          <div class="panel">
            <h2>ابدأ الجولة</h2>
            <p>اكتب اسمك وعنوان موضوع الكلمات.</p>
            <form id="intro-form" class="form-grid">
              <div>
                <label for="playerName">اكتب اسمك</label>
                <input
                  id="playerName"
                  type="text"
                  placeholder="مثال: أحمد"
                  autocomplete="name"
                />
              </div>
              <div>
                <label for="topicTitle">اكتب عنوان موضوع الكلمات</label>
                <input
                  id="topicTitle"
                  type="text"
                  placeholder="مثال: الفواكه"
                  autocomplete="off"
                />
              </div>
              <div class="actions">
                <button class="btn-primary" type="submit">التالي</button>
              </div>
              <div class="error" id="introError" role="alert"></div>
            </form>
          </div>
        </section>

        <section class="screen" id="screen-words">
          <div class="panel">
            <h2>اكتب الكلمات الخمس</h2>
            <p>كل كلمة يجب أن تكون مرتبطة بالموضوع.</p>
            <form id="words-form" class="form-grid">
              <div>
                <label for="word1">الكلمة 1</label>
                <input id="word1" type="text" placeholder="الكلمة الأولى" />
              </div>
              <div>
                <label for="word2">الكلمة 2</label>
                <input id="word2" type="text" placeholder="الكلمة الثانية" />
              </div>
              <div>
                <label for="word3">الكلمة 3</label>
                <input id="word3" type="text" placeholder="الكلمة الثالثة" />
              </div>
              <div>
                <label for="word4">الكلمة 4</label>
                <input id="word4" type="text" placeholder="الكلمة الرابعة" />
              </div>
              <div>
                <label for="word5">الكلمة 5</label>
                <input id="word5" type="text" placeholder="الكلمة الخامسة" />
              </div>
              <div class="actions">
                <button class="btn-secondary" type="button" id="backToIntro">
                  رجوع
                </button>
                <button class="btn-primary" type="submit">ترتيب الكلمات</button>
              </div>
              <div class="error" id="wordsError" role="alert"></div>
            </form>
          </div>
        </section>

        <section class="screen" id="screen-order">
          <div class="panel">
            <h2>رتب البطاقات</h2>
            <p>اسحب البطاقة للأعلى أو للأسفل لتحديد الترتيب من السهل إلى الأصعب.</p>
            <p class="hint">يمكنك الرجوع وتعديل أي كلمة قبل الإنهاء.</p>
            <ul class="sortable-list" id="sortableList"></ul>
            <div class="actions">
              <button class="btn-secondary" type="button" id="editWords">
                تعديل الكلمات
              </button>
              <button class="btn-primary" type="button" id="finishGame">
                إنهاء
              </button>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-result">
          <div class="panel">
            <div class="result-header">
              <h2 class="result-title">خذ سكرين شوت وشاركها مع خصمك</h2>
              <div class="player-meta">
                <p class="meta-line"><span>اللاعب:</span> <strong id="finalName"></strong></p>
                <p class="meta-line">
                  <span>عن:</span>
                  "<strong id="finalTopic"></strong>"
                </p>
              </div>
            </div>
            <div class="result-list" id="resultList"></div>
            <div class="restart-wrap">
              <button class="btn-secondary" id="restartBtn" type="button">
                جولة جديدة
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      const state = {
        name: "",
        topic: "",
        words: ["", "", "", "", ""],
        orderedWords: [],
      };

      const screens = {
        intro: document.getElementById("screen-intro"),
        words: document.getElementById("screen-words"),
        order: document.getElementById("screen-order"),
        result: document.getElementById("screen-result"),
      };

      const progressBars = Array.from(document.querySelectorAll("#progress span"));
      const introForm = document.getElementById("intro-form");
      const wordsForm = document.getElementById("words-form");
      const introError = document.getElementById("introError");
      const wordsError = document.getElementById("wordsError");
      const playerNameInput = document.getElementById("playerName");
      const topicTitleInput = document.getElementById("topicTitle");
      const wordInputs = Array.from(document.querySelectorAll("#words-form input[type='text']"));
      const sortableList = document.getElementById("sortableList");

      const finalName = document.getElementById("finalName");
      const finalTopic = document.getElementById("finalTopic");
      const resultList = document.getElementById("resultList");

      function setScreen(name) {
        Object.values(screens).forEach((screen) => screen.classList.remove("active"));
        screens[name].classList.add("active");

        const order = ["intro", "words", "order", "result"];
        const activeIndex = order.indexOf(name);
        progressBars.forEach((bar, index) => {
          bar.classList.toggle("active", index <= activeIndex);
        });
      }

      function clearErrors() {
        introError.textContent = "";
        wordsError.textContent = "";
      }

      function fillWordInputs() {
        state.words.forEach((word, index) => {
          wordInputs[index].value = word;
        });
      }

      function renderSortableList() {
        sortableList.innerHTML = "";
        state.orderedWords.forEach((word) => {
          const item = document.createElement("li");
          item.className = "word-card";
          item.dataset.word = word;
          item.innerHTML = `
            <span class="order-index"></span>
            <span class="word-text">${escapeHtml(word)}</span>
            <span class="drag-mark">☰</span>
          `;
          sortableList.appendChild(item);
        });
        updateOrderNumbers();
      }

      function getCurrentOrder() {
        return Array.from(sortableList.querySelectorAll(".word-card")).map((card) => card.dataset.word);
      }

      function updateOrderNumbers() {
        Array.from(sortableList.children).forEach((card, index) => {
          const counter = card.querySelector(".order-index");
          counter.textContent = index + 1;
        });
      }

      function renderResult() {
        finalName.textContent = state.name;
        finalTopic.textContent = state.topic;
        resultList.innerHTML = "";

        state.orderedWords.forEach((word, index) => {
          const chars = Array.from(word);
          const card = document.createElement("article");
          card.className = "result-card";

          const slots = chars
            .map((char, charIndex) => {
              const showChar = charIndex === 0 ? escapeHtml(char) : "";
              const className = charIndex === 0 ? "slot revealed" : "slot";
              return `<span class="${className}">${showChar}</span>`;
            })
            .join("");

          card.innerHTML = `
            <div class="result-top">
              <span class="result-rank">الترتيب ${index + 1}</span>
              <span class="result-length">عدد الأحرف: ${chars.length}</span>
            </div>
            <div class="slots">${slots}</div>
          `;
          resultList.appendChild(card);
        });
      }

      function escapeHtml(value) {
        return value
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      introForm.addEventListener("submit", (event) => {
        event.preventDefault();
        clearErrors();

        const name = playerNameInput.value.trim();
        const topic = topicTitleInput.value.trim();

        if (!name || !topic) {
          introError.textContent = "الرجاء كتابة الاسم وعنوان الموضوع.";
          return;
        }

        state.name = name;
        state.topic = topic;
        fillWordInputs();
        setScreen("words");
      });

      wordsForm.addEventListener("submit", (event) => {
        event.preventDefault();
        wordsError.textContent = "";

        const words = wordInputs.map((input) => input.value.trim());
        if (words.some((word) => !word)) {
          wordsError.textContent = "اكتب جميع الكلمات الخمس قبل المتابعة.";
          return;
        }

        state.words = words;
        state.orderedWords = [...words];
        renderSortableList();
        setScreen("order");
      });

      document.getElementById("backToIntro").addEventListener("click", () => {
        clearErrors();
        setScreen("intro");
      });

      document.getElementById("editWords").addEventListener("click", () => {
        state.words = getCurrentOrder();
        fillWordInputs();
        setScreen("words");
      });

      document.getElementById("finishGame").addEventListener("click", () => {
        state.orderedWords = getCurrentOrder();
        renderResult();
        setScreen("result");
      });

      document.getElementById("restartBtn").addEventListener("click", () => {
        state.name = "";
        state.topic = "";
        state.words = ["", "", "", "", ""];
        state.orderedWords = [];

        playerNameInput.value = "";
        topicTitleInput.value = "";
        fillWordInputs();
        sortableList.innerHTML = "";
        resultList.innerHTML = "";
        clearErrors();
        setScreen("intro");
      });

      let activeDragItem = null;
      let dragStartY = 0;
      let activeTouchId = null;
      let dragMode = "";

      function beginDrag(item, startY, mode) {
        activeDragItem = item;
        dragStartY = startY;
        dragMode = mode;
        activeDragItem.classList.add("dragging");
        activeDragItem.style.zIndex = "30";
      }

      function moveDrag(currentY) {
        if (!activeDragItem) {
          return;
        }

        const deltaY = currentY - dragStartY;
        activeDragItem.style.transform = `translateY(${deltaY}px)`;

        const siblings = Array.from(sortableList.querySelectorAll(".word-card:not(.dragging)"));
        const nextItem = siblings.find((sibling) => {
          const box = sibling.getBoundingClientRect();
          return currentY < box.top + box.height / 2;
        });

        if (nextItem) {
          sortableList.insertBefore(activeDragItem, nextItem);
        } else {
          sortableList.appendChild(activeDragItem);
        }

        updateOrderNumbers();
      }

      function endDrag() {
        if (!activeDragItem) {
          return;
        }

        activeDragItem.classList.remove("dragging");
        activeDragItem.style.transform = "";
        activeDragItem.style.zIndex = "";
        activeDragItem = null;
        dragStartY = 0;
        activeTouchId = null;
        dragMode = "";
      }

      sortableList.addEventListener("touchstart", (event) => {
        const item = event.target.closest(".word-card");
        if (!item) {
          return;
        }

        const touch = event.changedTouches[0];
        activeTouchId = touch.identifier;
        beginDrag(item, touch.clientY, "touch");
        event.preventDefault();
      });

      document.addEventListener(
        "touchmove",
        (event) => {
          if (!activeDragItem || dragMode !== "touch") {
            return;
          }

          const touch = Array.from(event.changedTouches).find((t) => t.identifier === activeTouchId);
          if (!touch) {
            return;
          }

          moveDrag(touch.clientY);
          event.preventDefault();
        },
        { passive: false }
      );

      document.addEventListener("touchend", (event) => {
        if (!activeDragItem || dragMode !== "touch") {
          return;
        }

        const touch = Array.from(event.changedTouches).find((t) => t.identifier === activeTouchId);
        if (!touch) {
          return;
        }

        endDrag();
      });

      document.addEventListener("touchcancel", () => {
        endDrag();
      });

      sortableList.addEventListener("mousedown", (event) => {
        if (event.button !== 0) {
          return;
        }

        const item = event.target.closest(".word-card");
        if (!item) {
          return;
        }

        beginDrag(item, event.clientY, "mouse");
        event.preventDefault();
      });

      document.addEventListener("mousemove", (event) => {
        if (!activeDragItem || dragMode !== "mouse") {
          return;
        }

        moveDrag(event.clientY);
      });

      document.addEventListener("mouseup", () => {
        if (dragMode === "mouse") {
          endDrag();
        }
      });
    </script>
  </body>
</html>
